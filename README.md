# LLMæ–‡æœ¬åˆ†ç±»é¡¹ç›®

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºå¤§è¯­è¨€æ¨¡å‹çš„æ–‡æœ¬åˆ†ç±»é¡¹ç›®ï¼Œæ”¯æŒå…¨å‚æ•°å¾®è°ƒå’ŒLoRAå¾®è°ƒä¸¤ç§è®­ç»ƒæ¨¡å¼ã€‚é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚

## ä¸»è¦åŠŸèƒ½ç‰¹æ€§

### ğŸš€ è®­ç»ƒæ¨¡å¼
- **å…¨å‚æ•°å¾®è°ƒ (Full Fine-tuning)**: æ”¯æŒå®Œæ•´çš„æ¨¡å‹å‚æ•°è®­ç»ƒ
- **LoRAå¾®è°ƒ**: ä½¿ç”¨ä½ç§©é€‚åº”æŠ€æœ¯ï¼Œå¤§å¹…å‡å°‘è®­ç»ƒå‚æ•°å’Œæ˜¾å­˜å ç”¨
- **è‡ªå®šä¹‰åˆ†ç±»å¤´**: LoRAæ¨¡å¼ä¸‹ä½¿ç”¨ä¸“é—¨è®¾è®¡çš„åˆ†ç±»ç½‘ç»œç»“æ„

### ğŸ“Š æ•°æ®é›†æ”¯æŒ
- **SST-2**: æƒ…æ„Ÿåˆ†ææ•°æ®é›† (2åˆ†ç±»)
- **R8**: æ–°é—»ä¸»é¢˜åˆ†ç±»æ•°æ®é›† (8åˆ†ç±»)
- **è‡ªåŠ¨æ ¼å¼æ£€æµ‹**: æ”¯æŒJSONå’ŒParquetæ ¼å¼æ•°æ®é›†
- **æ™ºèƒ½æ•°æ®åˆ‡åˆ†**: è‡ªåŠ¨ä»è®­ç»ƒé›†åˆ‡åˆ†éªŒè¯é›† (15%æ¯”ä¾‹)
- **æç¤ºè¯å¢å¼º**: ä¸ºè¾“å…¥æ–‡æœ¬è‡ªåŠ¨æ·»åŠ åˆ†ç±»æç¤ºè¯

### ğŸ”§ æŠ€æœ¯ç‰¹æ€§
- **æ··åˆç²¾åº¦è®­ç»ƒ**: æ”¯æŒfp16æ¨¡å¼ï¼Œæå‡è®­ç»ƒæ•ˆç‡
- **æ¢¯åº¦æ£€æŸ¥ç‚¹**: å‡å°‘æ˜¾å­˜å ç”¨
- **æœ€ä¼˜æ¨¡å‹ä¿å­˜**: è‡ªåŠ¨ä¿å­˜è®­ç»ƒè¿‡ç¨‹ä¸­çš„æœ€ä½³æ¨¡å‹
- **å¤šéšæœºç§å­**: æ”¯æŒ0ã€42ã€123ä¸‰ä¸ªéšæœºç§å­ï¼Œç¡®ä¿ç»“æœå¯å¤ç°
- **æ™ºèƒ½checkpointç®¡ç†**: åªä¿ç•™æœ€ä¼˜çš„2ä¸ªcheckpoint

## é¡¹ç›®ç»“æ„

```
LLM-TextClassification/
â”œâ”€â”€ main.py                 # ä¸»è®­ç»ƒè„šæœ¬
â”œâ”€â”€ train.sh               # æ‰¹é‡è®­ç»ƒè„šæœ¬
â”œâ”€â”€ requirements.txt        # ä¾èµ–åŒ…åˆ—è¡¨
â”œâ”€â”€ module/                 # æ ¸å¿ƒæ¨¡å—
â”‚   â””â”€â”€ argument.py        # å‚æ•°å®šä¹‰
â”œâ”€â”€ src/                   # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ config/           # é…ç½®æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ dataset_config.py
â”‚   â”œâ”€â”€ data/             # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”‚   â””â”€â”€ dataset_loader.py
â”‚   â”œâ”€â”€ models/           # æ¨¡å‹ç®¡ç†æ¨¡å—
â”‚   â”‚   â””â”€â”€ model_manager.py
â”‚   â”œâ”€â”€ training/         # è®­ç»ƒæ¨¡å—
â”‚   â”‚   â””â”€â”€ trainer.py
â”‚   â”œâ”€â”€ evaluation/       # è¯„ä¼°æ¨¡å—
â”‚   â”‚   â””â”€â”€ test_evaluator.py
â”‚   â””â”€â”€ utils/            # å·¥å…·æ¨¡å—
â”‚       â””â”€â”€ helpers.py
â”œâ”€â”€ scripts/               # è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ train_full_*.sh   # å…¨å‚å¾®è°ƒè„šæœ¬
â”‚   â””â”€â”€ train_lora_*.sh   # LoRAå¾®è°ƒè„šæœ¬
â”œâ”€â”€ data/                  # æ•°æ®é›†ç›®å½•
â””â”€â”€ ckpt/                  # é¢„è®­ç»ƒæ¨¡å‹ç›®å½•
```

## ç¯å¢ƒè¦æ±‚

- Python 3.8+
- PyTorch 2.0+
- Transformers 4.30+
- PEFT (LoRAæ”¯æŒ)
- Datasets
- Scikit-learn

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. å‡†å¤‡æ•°æ®

å°†æ•°æ®é›†æ”¾ç½®åœ¨ `data/datasets/` ç›®å½•ä¸‹ï¼Œæ”¯æŒä»¥ä¸‹ç»“æ„ï¼š
```
data/datasets/sst2/data/
â”œâ”€â”€ train.json
â”œâ”€â”€ dev.json
â””â”€â”€ test.json

# æˆ–
data/datasets/r8/data/
â”œâ”€â”€ train-00000-of-00001.parquet
â””â”€â”€ test-00000-of-00001.parquet
```

### 3. è¿è¡Œè®­ç»ƒ

#### å•ä¸ªè®­ç»ƒè„šæœ¬
```bash
# å…¨å‚å¾®è°ƒ
bash scripts/train_full_sst2_0.sh

# LoRAå¾®è°ƒ
bash scripts/train_lora_sst2_0.sh
```

#### æ‰¹é‡è®­ç»ƒ
```bash
# è¿è¡Œæ‰€æœ‰è®­ç»ƒè„šæœ¬
bash train.sh
```

## è®­ç»ƒå‚æ•°è¯´æ˜

### å…¨å‚æ•°å¾®è°ƒ
- **å­¦ä¹ ç‡**: 2e-5 (é€‚åˆå¤§æ¨¡å‹å¾®è°ƒ)
- **æ‰¹æ¬¡å¤§å°**: 4 (æ ¹æ®æ˜¾å­˜è°ƒæ•´)
- **è®­ç»ƒè½®æ•°**: 5 epochs
- **è¯„ä¼°é¢‘ç‡**: æ¯50æ­¥
- **ä¿å­˜é¢‘ç‡**: æ¯100æ­¥
- **ä¿å­˜é™åˆ¶**: æœ€å¤š2ä¸ªcheckpoint

### LoRAå¾®è°ƒ
- **å­¦ä¹ ç‡**: 5e-4 (LoRAé€šå¸¸éœ€è¦æ›´é«˜å­¦ä¹ ç‡)
- **æ‰¹æ¬¡å¤§å°**: 8 (LoRAæ˜¾å­˜å ç”¨æ›´å°‘)
- **è®­ç»ƒè½®æ•°**: 8 epochs
- **è¯„ä¼°é¢‘ç‡**: æ¯100æ­¥
- **ä¿å­˜é¢‘ç‡**: æ¯200æ­¥
- **LoRAé…ç½®**: r=64, alpha=16, dropout=0.1

## æ¨¡å‹é…ç½®

### è‡ªå®šä¹‰åˆ†ç±»å¤´ (LoRAæ¨¡å¼)
```python
class CustomClassifier(nn.Module):
    def __init__(self, input_size, out_features, hidden_dim=512):
        # ä¸‰å±‚å…¨è¿æ¥ç½‘ç»œ
        # input_size -> 512 -> 256 -> out_features
        # ä½¿ç”¨Xavierå‡åŒ€åˆå§‹åŒ–
        # åŒ…å«ReLUæ¿€æ´»å’ŒDropoutæ­£åˆ™åŒ–
```

### LoRAç›®æ ‡æ¨¡å—
- **æ³¨æ„åŠ›å±‚**: q_proj, k_proj, v_proj, o_proj
- **MLPå±‚**: gate_proj, up_proj, down_proj

## è¾“å‡ºè¯´æ˜

è®­ç»ƒå®Œæˆåï¼Œæ¯ä¸ªå®éªŒä¼šåœ¨å¯¹åº”çš„è¾“å‡ºç›®å½•ç”Ÿæˆï¼š
- `model.safetensors` / `adapter_model.safetensors`: è®­ç»ƒå¥½çš„æ¨¡å‹
- `test_results.json`: æµ‹è¯•é›†è¯„ä¼°ç»“æœ
- `test_summary.txt`: æµ‹è¯•ç»“æœæ‘˜è¦
- `checkpoint-*/`: è®­ç»ƒè¿‡ç¨‹ä¸­çš„checkpoint

## æç¤ºè¯æ ¼å¼

ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºè¾“å…¥æ–‡æœ¬æ·»åŠ åˆ†ç±»æç¤ºè¯ï¼š
```
Please carefully read the following reference text:"{text}", 
and determine which of the following categories it belongs to:{class_labels},answer:
```

å…¶ä¸­ `{class_labels}` æ ¹æ®æ•°æ®é›†ç±»å‹è‡ªåŠ¨ç”Ÿæˆï¼š
- **SST-2**: ["Negative", "Positive"]
- **R8**: ["acq", "corn", "crude", "earn", "grain", "interest", "money-fx", "ship"]

## æ³¨æ„äº‹é¡¹

1. **æ˜¾å­˜ç®¡ç†**: å…¨å‚å¾®è°ƒéœ€è¦è¾ƒå¤§æ˜¾å­˜ï¼Œå»ºè®®ä½¿ç”¨LoRAæ¨¡å¼
2. **æ•°æ®æ ¼å¼**: ç¡®ä¿æ•°æ®é›†åŒ…å«æ­£ç¡®çš„æ–‡æœ¬å’Œæ ‡ç­¾åˆ—
3. **æ¨¡å‹è·¯å¾„**: æ£€æŸ¥é¢„è®­ç»ƒæ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®
4. **éšæœºç§å­**: ä¸åŒç§å­ä¼šäº§ç”Ÿä¸åŒçš„è®­ç»ƒç»“æœ

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›é¡¹ç›®ï¼

